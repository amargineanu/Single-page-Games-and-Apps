<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Tetris Mobile</title>
  <style>
    :root{--cell:6vw;--cols:10;--rows:20}
    body{margin:0;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:100vh;background:#0b1220;color:#e6eef8;font-family:system-ui,Roboto,sans-serif;overflow:hidden}
    canvas{background:#071022;border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,.5);touch-action:none}
    .panel{display:flex;gap:10px;margin-top:6px;justify-content:center;align-items:center;flex-wrap:wrap;font-size:14px}
    button{background:#15304a;border:none;color:#dff;padding:8px 14px;border-radius:8px;font-size:14px}
    button:active{filter:brightness(1.3)}
    #scoreboard{font-size:13px;margin-top:4px;text-align:center}
    .controls{position:fixed;bottom:12px;display:flex;justify-content:center;gap:10px;flex-wrap:wrap;width:100%}
    .ctrl-btn{background:#15304a;border:none;border-radius:50%;width:60px;height:60px;color:#fff;font-size:22px;display:flex;align-items:center;justify-content:center;touch-action:manipulation}
    .ctrl-btn:active{background:#1d4566}
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div id="scoreboard">
    Score: <span id="score">0</span> | Level: <span id="level">1</span> | Lines: <span id="lines">0</span>
  </div>
  <div class="panel">
    <button id="start">Start</button>
    <button id="pause">Pause</button>
  </div>

  <!-- On-screen controls -->
  <div class="controls">
    <button class="ctrl-btn" id="left">←</button>
    <button class="ctrl-btn" id="rotate">⟳</button>
    <button class="ctrl-btn" id="right">→</button>
    <button class="ctrl-btn" id="drop">↓</button>
  </div>

  <script>
  const COLS=10,ROWS=20;const canvas=document.getElementById('game');const ctx=canvas.getContext('2d');const size=Math.floor(window.innerWidth*0.06);canvas.width=COLS*size;canvas.height=ROWS*size;
  const COLORS={I:'#49c6ff',J:'#2f74ff',L:'#ff9f3a',O:'#ffd24a',S:'#4efc6a',T:'#d86cff',Z:'#ff5c7a'};
  const SHAPES={I:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]],J:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],L:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],O:[[[1,1],[1,1]]],S:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]]],T:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],Z:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]]]};
  let grid,current,nextPiece,score,level,linesCleared,dropCounter,dropInterval,lastTime,gameOver,paused;
  function createMatrix(r,c){return Array.from({length:r},()=>Array(c).fill(0));}
  function randomPiece(){return Object.keys(SHAPES)[Math.floor(Math.random()*7)];}
  function createPiece(type){const states=SHAPES[type];return{type,states,state:0,matrix:states[0],row:0,col:Math.floor((COLS-states[0][0].length)/2)}}
  function initGame(){grid=createMatrix(ROWS,COLS);score=0;level=1;linesCleared=0;dropInterval=800;current=createPiece(randomPiece());nextPiece=createPiece(randomPiece());dropCounter=0;lastTime=0;gameOver=false;paused=false;updateUI();}
  function collide(mat,p,row,col){for(let r=0;r<p.matrix.length;r++){for(let c=0;c<p.matrix[r].length;c++){if(p.matrix[r][c]){const y=row+r,x=col+c;if(x<0||x>=COLS||y>=ROWS||y>=0&&mat[y][x])return true;}}}return false;}
  function merge(mat,p){for(let r=0;r<p.matrix.length;r++){for(let c=0;c<p.matrix[r].length;c++){if(p.matrix[r][c]){const y=p.row+r,x=p.col+c;if(y>=0)mat[y][x]=p.type;}}}}
  function sweep(){let lines=0;for(let y=ROWS-1;y>=0;y--){if(grid[y].every(v=>v)){grid.splice(y,1);grid.unshift(Array(COLS).fill(0));lines++;y++;}}if(lines){score+=[0,40,100,300,1200][lines]*level;linesCleared+=lines;level=Math.floor(linesCleared/10)+1;dropInterval=Math.max(100,800-(level-1)*70);}return lines;}
  function rotate(p,dir=1){const s=p.states;p.state=(p.state+dir+s.length)%s.length;p.matrix=s[p.state];if(collide(grid,p,p.row,p.col)){p.state=(p.state-dir+s.length)%s.length;p.matrix=s[p.state];}}
  function playerDrop(){if(collide(grid,current,current.row+1,current.col)){merge(grid,current);sweep();current=nextPiece;current.row=0;current.col=Math.floor((COLS-current.matrix[0].length)/2);nextPiece=createPiece(randomPiece());if(collide(grid,current,current.row,current.col))gameOver=true;}else current.row++;dropCounter=0;updateUI();}
  function hardDrop(){while(!collide(grid,current,current.row+1,current.col)){current.row++;score+=2;}playerDrop();}
  function updateUI(){document.getElementById('score').textContent=score;document.getElementById('level').textContent=level;document.getElementById('lines').textContent=linesCleared;}
  function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);for(let r=0;r<ROWS;r++){for(let c=0;c<COLS;c++){if(grid[r][c])drawCell(c,r,COLORS[grid[r][c]]);}}for(let r=0;r<current.matrix.length;r++){for(let c=0;c<current.matrix[r].length;c++){if(current.matrix[r][c])drawCell(current.col+c,current.row+r,COLORS[current.type]);}}}
  function drawCell(x,y,color){ctx.fillStyle=color;ctx.fillRect(x*size+1,y*size+1,size-2,size-2);}
  function update(time=0){const delta=time-lastTime;lastTime=time;if(!paused&&!gameOver){dropCounter+=delta;if(dropCounter>dropInterval)playerDrop();draw();}else{draw();if(gameOver){ctx.fillStyle='rgba(0,0,0,.6)';ctx.fillRect(0,canvas.height/2-40,canvas.width,80);ctx.fillStyle='#fff';ctx.font='20px system-ui';ctx.textAlign='center';ctx.fillText('Game Over',canvas.width/2,canvas.height/2);}}requestAnimationFrame(update);}
  document.getElementById('start').onclick=()=>initGame();document.getElementById('pause').onclick=()=>{paused=!paused;};
  document.addEventListener('keydown',e=>{if(gameOver)return;switch(e.key){case'ArrowLeft':if(!collide(grid,current,current.row,current.col-1))current.col--;break;case'ArrowRight':if(!collide(grid,current,current.row,current.col+1))current.col++;break;case'ArrowDown':if(!collide(grid,current,current.row+1,current.col))current.row++;break;case' ':hardDrop();break;case'ArrowUp':rotate(current);break;case'p':paused=!paused;break;}});
  document.getElementById('left').ontouchstart=()=>{if(!collide(grid,current,current.row,current.col-1))current.col--;};
  document.getElementById('right').ontouchstart=()=>{if(!collide(grid,current,current.row,current.col+1))current.col++;};
  document.getElementById('rotate').ontouchstart=()=>rotate(current);
  document.getElementById('drop').ontouchstart=()=>hardDrop();
  initGame();requestAnimationFrame(update);
  </script>
</body>
</html>
